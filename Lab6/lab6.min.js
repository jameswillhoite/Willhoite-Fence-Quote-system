function Bubble(){this.hidden=[];this.visable=[];this.visableSpikes=[];this.hiddenSpikes=[];var f=this;var c=2000;var p=10;var o=null;var k=(new Date().getTime())+c;var m=4000;var h=(new Date().getTime())+m;var b=1;function l(){var a=f.mainRandomInt(40,120);this.img="images/bubble.png";this.top=1000;this.left=0;this.speed=300;this.width=a;this.height=a;this.clickEvent=null;this.id=0;this.element=null;this.text=null;this.intervalID=null;this.points=0;this.generatePoints()}l.prototype={randomInt:function(r,a){return Math.floor(Math.random()*(a-r+1))+r},setTextPostion:function(){this.text.css({top:(this.top+(this.height/2)-5)+"px",left:(this.left+(this.width/2)-4)+"px"})},inflateBubble:function(){var a=this;a.speed=this.randomInt(20,100)/b;this.element.show();this.text.html(this.points);this.text.show();var r=-1;this.intervalID=setInterval(function(){a.top-=1;r=a.randomInt(-1,1);switch(r){case -1:a.left-=1;break;case 1:a.left+=1;break;case 0:break}a.element.css({top:a.top+"px",left:a.left+"px"});a.setTextPostion();if(a.top<=0){game.updateScore(-a.points);game.lostBubble();a.reset()}},a.speed);this.element.one("click mousedown",function(){game.updateScore(a.points);game.gotBubble();a.reset()});this.text.one("click mousedown",function(){game.updateScore(a.points);game.gotBubble();a.reset()})},generatePoints:function(){this.points=f.mainRandomInt(1,10)},reset:function(){var t=this;clearInterval(this.intervalID);this.element.unbind("click mousedown");this.text.unbind("click mousedown");this.element.hide();this.text.hide();this.generatePoints();var u=$("div#main").width()-100;this.top=$("div#main").height()-100;this.left=this.randomInt(0,u);this.element.css({top:t.top+"px",left:t.left+"px"});this.setTextPostion();for(var r=0;r<f.visable.length;r++){if(f.visable[r].id===this.id){var s=f.visable.splice(r,1);f.hidden.push(s[0]);break}}}};function q(){this.deductPoints=0;this.speed=0;this.img="images/needle.png";this.width=40;this.height=f.mainRandomInt(20,100);this.top=0;this.left=0;this.id=0;this.element=null;this.intervalID=null;this.timeOutID=null;this.dropSpike=null}q.prototype={makeSpike:function(){var a=this;this.speed=f.mainRandomInt(1,50)*b;this.generatePointDetuction();this.generateSpikeDropAt();this.element.slideDown(500);this.timeOutID=setTimeout(function(){a.fall()},a.dropSpike)},generatePointDetuction:function(){this.deductPoints=f.mainRandomInt(1,10)},generateSpikeDropAt:function(){this.dropSpike=f.mainRandomInt(100,2000)},detectCollision:function(){var x=(this.top+this.height)-10;var t=this.left;var s=(this.left+this.width);for(var r=0;r<f.visable.length;r++){var w=f.visable[r];var y=w.top+10;var v=w.left+10;var u=(w.left+w.width)-10;if(x>=y){if((t>=v&&t<=u)||(s>=v&&s<=u)){game.updateScore(-w.points);w.reset();game.lostBubble();break}}}},resetSpike:function(){var t=$("div#main").width()-100;clearInterval(this.intervalID);clearTimeout(this.timeOutID);this.intervalID=null;this.timeOutID=null;this.element.hide();this.top=0;this.left=f.mainRandomInt(0,t-this.width);this.element.css({top:this.top+"px",left:this.left+"px"});for(var r=0;r<f.visableSpikes.length;r++){if(f.visableSpikes[r].id=this.id){var s=f.visableSpikes.splice(r,1);f.hiddenSpikes.push(s[0]);break}}},fall:function(){var r=$("div#main").innerHeight();var a=f.mainRandomInt(this.height,r-this.height);var s=this;this.intervalID=setInterval(function(){s.top+=1;s.element.css({top:s.top+"px"});if(s.top>=a){s.resetSpike()}s.detectCollision()},s.speed)}};this.getBubble=function(){var a=f.hidden.shift();if(a){a.inflateBubble();f.visable.push(a)}return a};this.stop=function(){clearInterval(o);o=null;for(var r=0;r<this.visable.length;r++){clearInterval(this.visable[r].intervalID);this.visable[r].element.unbind("click mousedown");this.visable[r].intervalID=null}for(r=0;r<this.visableSpikes.length;r++){clearInterval(this.visableSpikes[r].intervalID);clearTimeout(this.visableSpikes[r].timeOutID);this.visableSpikes[r].intervalID=null;this.visableSpikes[r].timeOutID=null}};this.end=function(){clearInterval(o);o=null;while(f.visable.length>0){for(var r=0;r<f.visable.length;r++){f.visable[r].reset()}for(r=0;r<f.visableSpikes.length;r++){f.visableSpikes[r].resetSpike()}}while(f.visableSpikes.length>0){for(var r=0;r<f.visable.length;r++){f.visable[r].reset()}for(r=0;r<f.visableSpikes.length;r++){f.visableSpikes[r].resetSpike()}}};this.start=function(){if(this.visable.length>0){for(var r=0;r<this.visable.length;r++){this.visable[r].inflateBubble()}}o=setInterval(function(){var a=(new Date()).getTime();if(a>=k){f.getBubble();k=a+c;if(game.score>0&&game.score>=p&&c>400){c-=50;p+=10}}if(a>=h){f.getSpike();h=a+m}},1)};this.mainRandomInt=function(r,a){return Math.floor(Math.random()*(a-r+1))+r};for(var n=0;n<100;n++){var j=$("div#main").innerWidth()-100;var d=$("div#main").innerHeight()-100;var i=jQuery("div#main");var e=new l();e.id="bubble"+n;e.top=d;e.left=e.randomInt(0,j-e.width);i.append('<img id="'+e.id+'" src="'+e.img+'" style="top: '+e.top+"px; left: "+e.left+"px; width: "+e.width+"px; height: "+e.height+'px; display: none;">');e.element=jQuery("img#"+e.id);i.append('<span id="'+e.id+'Text" class="bubbleText"></span>');e.text=jQuery("span#"+e.id+"Text");e.setTextPostion();f.hidden.push(e);var g=new q();g.id="spike"+n;g.top=0;g.left=f.mainRandomInt(10,j-g.width);i.append('<img id="'+g.id+'" src="'+g.img+'" style="top: '+g.top+"px; left: "+g.left+"px; width: "+g.width+"px; height: "+g.height+'px; display: none;">');g.element=$("img#"+g.id);f.hiddenSpikes.push(g)}this.getSpike=function(){var a=f.hiddenSpikes.shift();if(a){a.makeSpike();f.visableSpikes.push(a)}return a};this.setSkillLevel=function(a){switch(a){case"beginner":c=2000;m=8000;b=1;break;case"intermediate":c=1500;m=4000;b=1.5;break;case"hard":c=1000;m=2000;b=1.2;break;case"insane":c=500;m=500;b=2;break}}}var game={score:0,bubblesPopped:0,bubblesLost:0,Bubble:null,init:function(){var b=this;var a=$(document).innerHeight();var c=$(document).innerWidth();jQuery("body div.container-fluid").css({height:a,width:c});this.Bubble=new Bubble();$("div#scoreBoard").css({top:"5px",left:(c-155)+"px"});this.updateScore(0);$("button#submitScore").on("click",function(){var d=$("div#gameOverModal form input#name");if(d.val().length===0){d.addClass("is-invalid")}else{d.removeClass("is-invalid")}b.saveScore(d.val(),String(b.bubblesPopped),String(b.bubblesLost),String(b.score))});$("div#gameOverModal form").on("submit",function(f){f.preventDefault();var d=$("div#gameOverModal form input#name");if(d.val().length===0){d.addClass("is-invalid")}else{d.removeClass("is-invalid")}b.saveScore(d.val(),String(b.bubblesPopped),String(b.bubblesLost),String(b.score))});$("body").on("drag contextmenu",function(d){d.preventDefault()})},randomNumber:function(d,a){if(!d){d=0.1}if(!a){a=10}var c=d;var b=a;return Math.random()*(b-c)+c},randomInt:function(b,a){return Math.floor(Math.random()*(a-b+1))+b},updateScore:function(a){this.score+=parseInt(a);var b=$("span#score");b.html(this.score)},lPad:function(a){var b=String(a);while(b.length<2){b="0"+b}return b},timeInterval:null,setSkillLevel:function(c){var a=this;this.score=0;this.bubblesLost=0;this.bubblesPopped=0;this.updateScore(0);this.Bubble.setSkillLevel(c);jQuery("div#howToPlay").hide();jQuery("div#scoreBoard").show();this.Bubble.start();var b=new Date((new Date()).getTime()+120000);this.timeInterval=setInterval(function(){var d=(new Date()).getTime();var e=new Date(b-d);jQuery("span#time").html(a.lPad(e.getMinutes())+":"+a.lPad(e.getSeconds()));if((d+1000)>=b.getTime()){clearInterval(a.timeInterval);a.Bubble.end();jQuery("div#howToPlay").fadeIn(500);jQuery("div#scoreBoard").fadeOut(500);a.showScore()}},1000)},gotBubble:function(){this.bubblesPopped++},lostBubble:function(){this.bubblesLost++},showScore:function(){var d=$("div#gameOverModal");d.find("span#bubblesLost").html(this.bubblesLost);d.find("span#bubblesPopped").html(this.bubblesPopped);d.find("span#score").html(this.score);var c=false;for(var b=0;b<this.stats.length;b++){if(this.score>this.stats[b].score){c=true;break}}if(this.stats.length<5){c=true}console.log("HighScore: "+c);if(c){d.find("div#enterName").show();d.find("button#submitScore").show()}else{d.find("div#enterName").hide();d.find("button#submitScore").hide()}d.modal("show")},stats:[],saveScore:function(b,c,e,g){var f=$("table#statsBoard tbody");var d=$("div#gameOverModal");var a=this;jQuery.ajax({type:"POST",url:window.baseURL+"controller.php?task=saveGame",data:{name:b,bubblesLost:e,bubblesPopped:c,score:g},dataType:"json",cache:false,beforeSend:function(){},complete:function(){},success:function(l){console.log(l);if(l.error){console.log(l.error_msg);return}var j={id:null,name:b,bubblesPopped:c,bubblesLost:e,score:g};a.stats.push(j);a.stats.sort(function(n,m){if(parseInt(n.score)>parseInt(m.score)){return -1}if(parseInt(n.score)<parseInt(m.score)){return 1}return 0});var k="";var h=(a.stats.length>5)?5:a.stats.length;for(var i=0;i<h;i++){k+="<tr><td>"+a.stats[i].name+"</td><td>"+a.stats[i].bubblesPopped+"</td><td>"+a.stats[i].bubblesLost+"</td><td>"+a.stats[i].score+"</td></tr>"}f.empty().html(k);d.find("input#name").val("");d.modal("hide");a.replaceID=null},error:function(i,h,j){console.log(i,h,j)}})}};