"use strict";var listUsers={init:function(){var a=this;var b=jQuery("div#main div#user-tab input#name");jQuery('div#main div#groups input[type="checkbox"]').on("change",function(){var c=b.attr("data-id");var d=jQuery(this).val();if(jQuery(this).is(":checked")){a.updateGroup(c,d,"add")}else{a.updateGroup(c,d,"remove")}})},users:[],addRow:function(f,c,b,a){this.users.push({id:parseInt(f),name:c,email:b,groups:a});var e=jQuery("div#main table#users tbody");var d="<tr><td>"+f+"</td><td>"+c+"</td><td>"+b+'</td><td><a href="#" onclick="listUsers.loadUser('+f+');" title="Edit User"><i class="fas fa-user-edit"></i></a> </td>';e.append(d)},hideList:function(){var a=jQuery("div#main div#listOfUsers");a.hide()},showList:function(){this.hideUser();var a=jQuery("div#main div#listOfUsers");a.show()},hideUser:function(){var a=jQuery("div#main div#editUser");a.hide()},showUser:function(){this.hideList();var a=jQuery("div#main div#editUser");a.show()},loadUser:function(e){var b=jQuery.grep(this.users,function(f){return f.id===parseInt(e)})[0];if(!b){return false}jQuery("div#main div#editUser input#name").val(b.name).attr("data-id",e);jQuery("div#main div#editUser input#email").val(b.email);var a=jQuery("div#main div#editUser div#groups");for(var c=0;c<b.groups.length;c++){var d=b.groups[c];a.find("input#groupID"+d).attr("checked",true)}this.showUser()},clearUser:function(){var c=jQuery("div#main div#editUser input#name");var b=jQuery("div#main div#editUser input#email");var a=jQuery("div#main div#editUser input#password");var d=jQuery("div#main div#editUser input#password2");c.val("");c.attr("data-id","");b.val("");a.val("");d.val("");jQuery('div#groups input[type="checkbox"]').each(function(){jQuery(this).attr("checked",false)})},updateGroup:function(c,d,a){if(!c&&!d){return false}var b=this;jQuery.ajax({type:"POST",url:window.baseURL+"/router.php?task=addUserJS.updateGroup",data:{uid:c,gid:d,addRemove:a},dataType:"json",cache:false,beforeSend:function(){},complete:function(){},success:function(f){console.log(f);if(f.error){console.log(f.error_msg);return}var e=jQuery.grep(b.users,function(g){return g.id===parseInt(c)})[0];e.groups=f.data},error:function(f,e,g){console.log(f,e,g)}})},updateUser:function(){var m=this;var a=jQuery("div#main div#editUser input#name");var j=jQuery("div#main div#editUser input#email");var l=jQuery("div#main div#editUser input#password");var d=jQuery("div#main div#editUser input#password2");var b=a.attr("data-id");var g=true;var k=[];var c={};c.uid=b;var e=jQuery.grep(this.users,function(i){return i.id===parseInt(b)})[0];if(e.name!==a.val()){if(!/^[a-zA-Z\s]{6,}$/.test(a.val())){a.addClass("is-invalid");k.push("Name is invalid");g=false}else{a.removeClass("is-invalid");c.name=a.val()}}if(e.email!==j.val()){if(!/^[a-zA-Z0-9.!#$%&'*+/=?^_`{|}~-]+@[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?(?:\.[a-zA-Z0-9](?:[a-zA-Z0-9-]{0,61}[a-zA-Z0-9])?)*$/.test(j.val())){j.addClass("is-invalid");k.push("Email address is invalid");g=false}else{j.removeClass("is-invalid");c.email=j.val()}}if(l.val()){if(!/^[a-zA-Z0-9\s\!\@\#\$\%\^\&\*\(\)\-\=\_\+\`\~\.\/\?\\\<\>]{6,}$/.test(l.val())){l.addClass("is-invalid");k.push("Password must be at least 6 characters or contains invalid characters");g=false}else{if(l.val()!==d.val()){d.addClass("is-invalid");g=false;k.push("The password do not match")}else{d.removeClass("is-invalid");l.removeClass("is-invalid");c.password=l.val();c.password2=d.val()}}}if(g===false){var h="<ul>";for(var f=0;f<k.length;f++){h+="<li>"+k[f]+"</li>"}h+="</ul>";m.displayErrorMsg(h,"danger",12);return}jQuery.ajax({type:"POST",url:window.baseURL+"/router.php?task=addUserJS.updateUser",data:c,dataType:"json",cache:false,beforeSend:function(){jQuery("div.overlay").fadeIn("fast")},complete:function(){jQuery("div.overlay").fadeOut("fast")},success:function(i){if(i.error){m.displayErrorMsg(i.error_msg,"danger");return}e.name=a.val();e.email=j.val();m.displayErrorMsg("The user has been updated.","success")},error:function(n,i,o){console.log(n,i,o)}})},closeUser:function(){this.clearUser();this.showList()},errorID:null,errorEl:null,displayErrorMsg:function(a,f,e){var b=this;if(this.errorID){this.errorEl.slideUp("500");clearTimeout(b.errorID);this.errorID=null;this.errorEl=null}var c;var d;if(jQuery("div.modal.show").length>0){c=jQuery("div.modal.show div#error_msg")}else{c=jQuery("div#main-content div#mainErrorMsg div#error_msg")}c.removeClass("alert-success alert-danger alert-info alert-warning");c.empty();c.html(a);c.addClass("alert-"+f);b.errorEl=c;if(e){d=e*1000}else{d=400*a.length}c.slideDown(500);b.errorID=setTimeout(function(){c.slideUp(500)},d)}};