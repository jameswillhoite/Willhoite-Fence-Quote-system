"use strict";var quoteSearch={init:function(){var a=this;a.modalListeners()},errorID:null,displayErrorMsg:function(a,f,e){var b=this;if(this.errorID){this.errorEl.slideUp("500");clearTimeout(b.errorID);this.errorID=null;this.errorEl=null}var c;var d;if(jQuery("div.modal.show").length>0){c=jQuery("div.modal.show div#error_msg")}else{c=jQuery("div#main-content div#mainErrorMsg div#error_msg")}c.removeClass("alert-success alert-danger alert-info alert-warning");c.empty();c.html(a);c.addClass("alert-"+f);b.errorEl=c;if(e){d=e*1000}else{d=400*a.length}c.slideDown(500);b.errorID=setTimeout(function(){c.slideUp(500)},d)},modalListeners:function(){var b=this;var e=jQuery("div#main-content div#main");var a=e.find("input#searchValue");var d=e.find("select#fenceStyles");var c=e.find("input#zipCode");e.find("button#clear").on("click",function(){b.clearSearch()});e.on("shown.bs.modal",function(){e.find("input#searchValue").val("").focus()});e.find("select#searchBy").on("change",function(){var f=jQuery(this).val();switch(f){case"jobID":c.val("").parent().hide();d.parent().hide();a.parent().show();break;case"customerName":a.parent().show();c.parent().show();d.parent().hide();break;case"styleName":a.parent().hide();c.parent().show();d.parent().show();break;case"phone":d.parent().hide();a.parent().show();c.parent().show();break}});c.on("keyup",function(){if(c.val().length>0&&!/^[0-9]{5,5}$/.test(c.val())){c.addClass("is-invalid")}else{c.removeClass("is-invalid")}});a.on("keyup",function(g){var f=e.find("select#searchBy");switch(f.val()){case"jobID":if(!/^[0-9]*$/.test(a.val())){a.addClass("is-invalid")}else{a.removeClass("is-invalid")}break;case"customerName":if(!/^[a-zA-Z\s\&]*$/.test(a.val())){a.addClass("is-invalid")}else{a.removeClass("is-invalid")}break;case"phone":if(!/^(?:\(?[0-9]{0,3}\)?\s?)[|\-|\.]?[0-9]{3,3}[\-|\.]?[0-9]{4,4}$/.test(a.val())){a.addClass("is-invalid")}else{a.removeClass("is-invalid")}break}if(g.keyCode===13){b.doSearch()}});e.find("button#search").on("click",function(){b.doSearch()});e.find("table#searchTable tbody").on("click","tr",function(){var f=jQuery(this).attr("data-id");b.loadPDF(f);e.modal("hide")})},clearSearch:function(){var a=jQuery("div#main-content div#main");a.find("input#searchValue").val("");a.find("select#fenceStyles").val(a.find("select#fenceStyles option:first").val());a.find("input#zipCode").val("")},doSearch:function(){var b=this;var g=jQuery("div#main-content div#main");var f=g.find("select#searchBy").val();var a=g.find("input#searchValue");var e=g.find("select#fenceStyles");var c=g.find("input#zipCode");var d=g.find("table#searchTable tbody");var h=true;if(c.val().length>0&&(f==="customerName"||f==="styleName"||f==="phone")){if(c.val().length>0&&!/^[0-9]{5,5}$/.test(c.val())){c.addClass("is-invalid");h=false}else{c.removeClass("is-invalid")}}else{c.removeClass("is-invalid")}switch(f){case"jobID":if(!/^[0-9]*$/.test(a.val())){a.addClass("is-invalid");h=false}else{a.removeClass("is-invalid")}break;case"customerName":if(!/^[a-zA-Z\s\&]*$/.test(a.val())){a.addClass("is-invalid");h=false}else{a.removeClass("is-invalid")}break;case"phone":if(!/^(?:\(?[0-9]{0,3}\)?\s?)[|\-|\.]?[0-9]{3,3}[\-|\.]?[0-9]{4,4}$/.test(a.val())){a.addClass("is-invalid");h=false}else{a.removeClass("is-invalid")}break;case"styleName":a=e;break}if(!h){b.displayErrorMsg("Please correct the Errors below","danger");return}jQuery.ajax({type:"POST",url:window.baseURL+"/router.php?task=viewJS.doSearch",data:{searchBy:f,searchFor:a.val(),zip:c.val()},dataType:"json",cache:false,beforeSend:function(){jQuery("div.overlay").fadeIn("fast")},complete:function(){jQuery("div.overlay").fadeOut("fast")},success:function(n){console.log(n);if(n.error){b.displayErrorMsg(n.error_msg,"danger");return}if(!n.data||n.data.length===0){b.displayErrorMsg("I don't have anything in my Database.","info");return}var m="";for(var j=0;j<n.data.length;j++){var o=n.data[j];m+='<tr data-id="'+o.JobID+'"><td>'+o.JobID+"</td><td>"+o.CustomerName+"</td><td>"+o.CustomerCity+"</td><td>"+o.CustomerZip+"</td><td>";var l=0;for(var k in o.Styles){if(l>0){m+="<br/>"}m+=o.Styles[k].Style;l++}m+="</td></tr>"}d.html(m)},error:function(j,i,k){console.log(j,i,k)}})},loadPDF:function(b){if(!b||isNaN(b)){return false}var a=window.baseURL+"/docs/GenerateQuote.php?view=browser&jobID="+b;window.open(a,"__BLANK")},getJob:function(b){var a=this;if(!b){jQuery("div#main-content div#searchModal").modal("show");return}jQuery.ajax({type:"POST",url:window.baseURL+"/router.php?task=viewJS.getJobInfo",data:{jobID:b},dataType:"json",cache:false,beforeSend:function(){jQuery("div.overlay").fadeIn("fast")},complete:function(){jQuery("div.overlay").fadeOut("fast")},success:function(d){console.log(d);if(d.error){a.displayErrorMsg(d.error_msg,"danger");return}var e=d.data;a.fillHeader(e.DateSold,e.CustomerName,e.CustomerAddress,e.CustomerCity,e.CustomerState,e.CustomerZip,e.CustomerPhoneType,e.CustomerPhone,e.CustomerEmail)},error:function(e,d,f){console.log(e,d,f)}})},fillHeader:function(j,b,h,e,i,f,g,c,d){var a=jQuery("div#main-content div#main");a.find("p#dateSold").html(j)}};